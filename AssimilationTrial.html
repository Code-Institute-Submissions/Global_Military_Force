<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>Document</title>
        
        <link rel="stylesheet" type="text/css" href="style.css">
        <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/dc/2.1.8/dc.min.css"/>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    
        
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/crossfilter/1.3.12/crossfilter.min.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/dc/2.1.8/dc.js"></script>
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/queue-async/1.0.7/queue.min.js"></script>
        
    </head>
    <body>
    
    <!--................................................................................Manpower-->   
        <div class="chart-stage">
            <button class="btn btn-warning"><a href="javascript:dc.filterAll(); dc.renderAll();">Reset All</a></button>

        </div>
        
        <div class="container con1 nopadding">
            <div class="row row1">
                    <div class="col-md-6" id="GFPRank"></div>
                    <div class="col-md-6" id="TotalPopBar"></div>
            </div>        
        </div>
         
        <div class="container con2 nopadding">
            <div class="row row2">
                    <div class="col-md-6" id="ManpowerStack"></div>
                    <div class="col-md-6" id="TotPersStack"></div>
            </div>        
        </div>
        <hr>
        <hr>
        
        
    <!--................................................................................Airpower   -->
        
        
        <div class="container con3 nopadding">
            <div class="row row3">
                    <div class="col-md-6" id="TotalAir"></div>
                    <div class="col-md-6" id="AirStack"></div>
            </div>        
        </div>
         
        <div class="container con4 nopadding">
            <div class="row row4">
                    <div class="col-md-6" id="HeliStack"></div>
                    
            </div>        
        </div>
        <hr>
        <hr>
        
        
    <!--................................................................................Army    -->    
        
        
        <div class="container con5 nopadding">
            <div class="row row5">
                    <div class="col-md-6" id="ArmyStack"></div>
            </div>        
        </div>
        <hr>
        <hr>
        
    <!--................................................................................Naval    -->    
        
        
        <div class="container con6 nopadding">
            <div class="row row6">
                    <div class="col-md-6" id="TotalNavalBar"></div>
                    <div class="col-md-6" id="NavalStack"></div>
            </div>        
        </div>
        <hr>
        <hr>
        
        
    <!--................................................................................-->
      
      

    
        <script>
        queue()
            .defer(d3.csv, "data/Z_Total_Breakdown.csv")
    
            .await(makeGraphs);
            
        
        function makeGraphs(error, TotalData) {
            var ndx = crossfilter(TotalData);
            
          
    // ................................................................................MANPOWER Ranked
            var GFPRank_dim = ndx.dimension(dc.pluck('Country'));

            var GFPRank_group = GFPRank_dim.group().reduceSum(function(d) {
                if (d.Type === "Power_Index_rating") {
                    return d.Count;
                } else {
                    return 0;
                }
            });


            console.log(GFPRank_group.all());
            
            var GFPBar = dc.rowChart("#GFPRank");
            
            GFPBar
                .width(600)
                .height(450)
                .dimension(GFPRank_dim)
                .group(GFPRank_group)
                .xAxis().ticks(9);
        
    // ................................................................................Manpower Fixed 
        
        
            var TotalPop_dim = ndx.dimension(dc.pluck("Country"));
            var TotalPop_group = TotalPop_dim.group().reduceSum(function(d) {
                if (d.Type === "Total_Population") {
                    return d.Count;
                } else {
                    return 0;
                }
            });
            
            // console.log(FightersByCountry.all())
            
            var PopChart = dc.barChart ("#TotalPopBar");
                
                PopChart
                    .width(600)
                    .height(450)
                    .dimension(TotalPop_dim)
                    .group(TotalPop_group)
                    .transitionDuration(700)
                    .x(d3.scale.ordinal().domain(["USA","Russia","China","India","France","UK","Japan","Turkey","Germany","Egypt"]))
                    .xUnits(dc.units.ordinal)
                    .xAxisLabel("Country")
                    .yAxisLabel("Population")
                    .yAxis().ticks(10);
    
           
                


            
            var Manpower_dim = ndx.dimension(dc.pluck('Country'));
            var Manpower_group = Manpower_dim.group().reduceSum(function(d) {
                if (d.Type === "Manpower_Available") {
                    return d.Count;
                } else {
                    return 0;
                }
            });
            var ReachingAgeByCountry = Manpower_dim.group().reduceSum(function(d) {
                if (d.Type === "Reaching_Military_Age") {
                    return d.Count;
                } else {
                    return 0;
                }
            });
            var MilChart = dc.barChart ("#ManpowerStack");
                
                MilChart
                    .width(600)
                    .height(450)
                    .margins({top: 50, right: 50, bottom: 50, left: 50})
                    .dimension(Manpower_dim)
                    .group(Manpower_group)
                    .stack(ReachingAgeByCountry)
                    .transitionDuration(700)
                    .x(d3.scale.ordinal().domain(["USA","Russia","China","India","France","UK","Japan","Turkey","Germany","Egypt"]))
                    .xUnits(dc.units.ordinal)
                    .xAxisLabel("Country")
                    .yAxisLabel("Military Personnel")
                    .yAxis().ticks(7);
            
            
            
            
            
            
            
            var TotalPersonnel_dim = ndx.dimension(dc.pluck('Country'));
            var ActivePersByCountry = TotalPersonnel_dim.group().reduceSum(function(d) {
                if (d.Type === "Active_Personnel") {
                    return d.Count;
                } else {
                    return 0;
                }
            });
            var ReservePersByCountry = TotalPersonnel_dim.group().reduceSum(function(d) {
                if (d.Type === "Reserve_Personnel") {
                    return d.Count;
                } else {
                    return 0;
                }
            });
            var MilChart = dc.barChart ("#TotPersStack");
                
                MilChart
                    .width(600)
                    .height(450)
                    .margins({top: 50, right: 50, bottom: 50, left: 50})
                    .dimension(TotalPersonnel_dim)
                    .group(ActivePersByCountry)
                    .stack(ReservePersByCountry)
                    .transitionDuration(700)
                    .x(d3.scale.ordinal().domain(["USA","Russia","China","India","France","UK","Japan","Turkey","Germany","Egypt"]))
                    .xUnits(dc.units.ordinal)
                    .xAxisLabel("Country")
                    .yAxisLabel("Military Personnel")
                    .yAxis().ticks(7);
                
            
            
            
            
            
                
           
           
// ................................................................................           
    // ................................................................................AIRPOWER
            
            
            
            var TotalAir_dim = ndx.dimension(dc.pluck("Country"));
            var TotalAirStrByCountry = TotalAir_dim.group().reduceSum(function(d) {
                if (d.Type === "Total_Aircraft_Strength") {
                    return d.Count;
                } else {
                    return 0;
                }
            });
            
            // console.log(FightersByCountry.all())
            
            var stackedChart = dc.barChart ("#TotalAir")
                
                stackedChart
                    .width(600)
                    .height(450)
                    .dimension(TotalAir_dim)
                    .group(TotalAirStrByCountry)
                    .x(d3.scale.ordinal().domain(["USA","Russia","China","India","France","UK","Japan","Turkey","Germany","Egypt"]))
                    .xUnits(dc.units.ordinal)
                    .xAxisLabel("Country")
                    .yAxisLabel("Total Aircraft Strength");
            
            
            
            
            
            
    
            var AirBreak_dim = ndx.dimension(dc.pluck("Country"));
            var FightersByCountry = AirBreak_dim.group().reduceSum(function(d) {
                if (d.Type === "Fighter_Aircraft") {
                    return d.Count;
                } else {
                    return 0;
                }
            });
            var AttakersByCountry = AirBreak_dim.group().reduceSum(function(d) {
                if (d.Type === "Attack_Aircraft") {
                    return d.Count;
                } else {
                    return 0;
                }
            });
            var TransportersByCountry = AirBreak_dim.group().reduceSum(function(d) {
                if (d.Type === "Transport_Aircraft") {
                    return d.Count;
                } else {
                    return 0;
                }
            });
            var TrainersByCountry = AirBreak_dim.group().reduceSum(function(d) {
                if (d.Type === "Trainer_Aircraft") {
                    return d.Count;
                } else {
                    return 0;
                }
            });
            
            
            var stackedChart = dc.barChart ("#AirStack")
                
                stackedChart
                    .width(600)
                    .height(450)
                    .dimension(AirBreak_dim)
                    .group(FightersByCountry)
                    .stack(AttakersByCountry)
                    .stack(TransportersByCountry)
                    .stack(TrainersByCountry)
                    .x(d3.scale.ordinal().domain(["USA","Russia","China","India","France","UK","Japan","Turkey","Germany","Egypt"]))
                    .xUnits(dc.units.ordinal)
                    .xAxisLabel("Country")
                    .yAxisLabel("Number of Aircraft")
                    .legend(dc.legend())
                    .renderlet(function (chart) {
        
                        //Check if labels exist
                        var gLabels = chart.select(".labels");
                        if (gLabels.empty()){
                            gLabels = chart.select(".chart-body").append('g').classed('labels', true);
                        }
                        
                        var gLabelsData = gLabels.selectAll("text").data(chart.selectAll(".bar")[0]);
                        
                        gLabelsData.exit().remove(); //Remove unused elements
                        
                        gLabelsData.enter().append("text") //Add new elements
                        
                        gLabelsData
                        .attr('text-anchor', 'middle')
                        .attr('fill', 'white')
                        .text(function(d){
                            return d3.select(d).data()[0].data.value
                        })
                        .attr('x', function(d){ 
                            return +d.getAttribute('x') + (d.getAttribute('width')/2); 
                        })
                        .attr('y', function(d){ return +d.getAttribute('y') + 15; })
                        .attr('style', function(d){
                            if (+d.getAttribute('height') < 18) return "display:none";
                        });
                        
                    });
                    
                    
                    
         
            
            var Heli_dim = ndx.dimension(dc.pluck("Country"));
            var TotalHeliByCountry = Heli_dim.group().reduceSum(function(d) {
                if (d.Type === "Other_Helicopter_Strength") {
                    return d.Count;
                } else {
                    return 0;
                }
            });
            var AttackHeliByCountry = Heli_dim.group().reduceSum(function(d) {
                if (d.Type === "Attack_Helicopters") {
                    return d.Count;
                } else {
                    return 0;
                }
            });
            
            
            var stackedChart = dc.barChart ("#HeliStack")
                
                stackedChart
                    .width(600)
                    .height(450)
                    .dimension(Heli_dim)
                    .group(TotalHeliByCountry)
                    .stack(AttackHeliByCountry)
                    .x(d3.scale.ordinal().domain(["USA","Russia","China","India","France","UK","Japan","Turkey","Germany","Egypt"]))
                    .xUnits(dc.units.ordinal)
                    .xAxisLabel("Country")
                    .yAxisLabel("Number of Helicopter");
    
    
    
    
            
    
            
    // ................................................................................ARMY
           
           
           
            var ArmyDim = ndx.dimension(dc.pluck("Country"));
            var CombatTanksByCountry = ArmyDim.group().reduceSum(function(d) {
                if (d.Type === "Combat_Tanks") {
                    return d.Count;
                } else {
                    return 0;
                }
            });
            var ArmouredFVByCountry = ArmyDim.group().reduceSum(function(d) {
                if (d.Type === "Armoured_Fighting_Vehicles") {
                    return d.Count;
                } else {
                    return 0;
                }
            });
            var SelfPropArtilleryByCountry = ArmyDim.group().reduceSum(function(d) {
                if (d.Type === "Self_Propelled_Artillery") {
                    return d.Count;
                } else {
                    return 0;
                }
            });
            var TowedArtilleryByCountry = ArmyDim.group().reduceSum(function(d) {
                if (d.Type === "Towed_Artillery") {
                    return d.Count;
                } else {
                    return 0;
                }
            });
            var RocketProjByCountry = ArmyDim.group().reduceSum(function(d) {
                if (d.Type === "Rocket_Projectors") {
                    return d.Count;
                } else {
                    return 0;
                }
            });
            
            
            
            var stackedChart = dc.barChart ("#ArmyStack")
                
                stackedChart
                    .width(600)
                    .height(450)
                    .dimension(ArmyDim)
                    .group(CombatTanksByCountry)
                    .stack(ArmouredFVByCountry)
                    .stack(SelfPropArtilleryByCountry)
                    .stack(TowedArtilleryByCountry)
                    .stack(RocketProjByCountry)
                    .x(d3.scale.ordinal().domain(["USA","Russia","China","India","France","UK","Japan","Turkey","Germany","Egypt"]))
                    .xUnits(dc.units.ordinal)
                    .xAxisLabel("Country")
                    .yAxisLabel("Number of Vehicles");
            
            
            
            
            
                
    // ................................................................................NAVY        
            
            
            
            
            var NavalDim = ndx.dimension(dc.pluck("Country"));
            var TotalNavalAssByCountry = NavalDim.group().reduceSum(function(d) {
                if (d.Type === "Total_Naval_Assets") {
                    return d.Count;
                } else {
                    return 0;
                }
            });
            

            var NavalChart = dc.barChart ("#TotalNavalBar");
                
                NavalChart
                    .width(600)
                    .height(450)
                    .dimension(NavalDim)
                    .group(TotalNavalAssByCountry)
                    .transitionDuration(700)
                    .x(d3.scale.ordinal().domain(["USA","Russia","China","India","France","UK","Japan","Turkey","Germany","Egypt"]))
                    .xUnits(dc.units.ordinal)
                    .xAxisLabel("Country")
                    .yAxisLabel("Population")
                    .yAxis().ticks(10);
        
            
            
            
            
            
            var NavalBreak_dim = ndx.dimension(dc.pluck("Country"));
            var MineVesselsByCountry = NavalBreak_dim.group().reduceSum(function(d) {
                if (d.Type === "Mine_Warefare_Vessels") {
                    return d.Count;
                } else {
                    return 0;
                }
            });
            var PatrolCraftByCountry = NavalBreak_dim.group().reduceSum(function(d) {
                if (d.Type === "Patrol_Craft") {
                    return d.Count;
                } else {
                    return 0;
                }
            });
            var SubmarinesByCountry = NavalBreak_dim.group().reduceSum(function(d) {
                if (d.Type === "Submarines") {
                    return d.Count;
                } else {
                    return 0;
                }
            });
            var CorvettesByCountry = NavalBreak_dim.group().reduceSum(function(d) {
                if (d.Type === "Corvettes") {
                    return d.Count;
                } else {
                    return 0;
                }
            });
            var DestroyersByCountry = NavalBreak_dim.group().reduceSum(function(d) {
                if (d.Type === "Destroyers") {
                    return d.Count;
                } else {
                    return 0;
                }
            });
            var FrigatesByCountry = NavalBreak_dim.group().reduceSum(function(d) {
                if (d.Type === "Frigates") {
                    return d.Count;
                } else {
                    return 0;
                }
            });
            var AircraftCarriersByCountry = NavalBreak_dim.group().reduceSum(function(d) {
                if (d.Type === "Aircraft_Carriers") {
                    return d.Count;
                } else {
                    return 0;
                }
            });
            
            
            
            
            var NavalChart2 = dc.barChart ("#NavalStack")
                
                NavalChart2
                    .width(600)
                    .height(450)
                    .dimension(NavalBreak_dim)
                    .group(MineVesselsByCountry)
                    .stack(PatrolCraftByCountry)
                    .stack(SubmarinesByCountry)
                    .stack(CorvettesByCountry)
                    .stack(DestroyersByCountry)
                    .stack(FrigatesByCountry)
                    .stack(AircraftCarriersByCountry)
                    .x(d3.scale.ordinal().domain(["USA","Russia","China","India","France","UK","Japan","Turkey","Germany","Egypt"]))
                    .xUnits(dc.units.ordinal)
                    .xAxisLabel("Country")
                    .yAxisLabel("Number of Vehicles");
            
    
    // ................................................................................
    
    
            dc.renderAll();        
        }         
        
               
        </script>
        
    </body>
    
    <script type="text/javascript" src="https://code.jquery.com/jquery.min.js"></script>
    <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    
</html>